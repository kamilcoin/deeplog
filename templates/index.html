<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <title>ðŸ”ŽDeepLog â€” Log Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

</head>
<body>
  <nav class="cyber-navbar">
    <div class="nav-left">
      <a href="https://github.com/kamilcoin" target="_blank" title="kamilcoin">
        <img src="https://avatars.githubusercontent.com/u/11111111?v=4" alt="kamilcoin" class="nav-avatar">
      </a>
      <a href="https://github.com/RichardAlmeyda" target="_blank" title="RichardAlmeyda">
        <img src="https://avatars.githubusercontent.com/u/12222222?v=4" alt="RichardAlmeyda" class="nav-avatar">
      </a>
    </div>
  </nav>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash-messages">
        {% for message in messages %}
          <div class="flash-message">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="container">
    <h1>
      <span style="vertical-align: middle;">
        <svg width="36" height="36" viewBox="0 0 32 32" style="margin-bottom: -7px;">
          <circle cx="15" cy="15" r="10" fill="#2563eb" fill-opacity="0.14"/>
          <circle cx="15" cy="15" r="7" fill="none" stroke="#60a5fa" stroke-width="2.4"/>
          <circle cx="15" cy="15" r="3" fill="#60a5fa"/>
          <rect x="23" y="23" width="8" height="3" rx="1.5" fill="#2563eb" transform="rotate(45 23 23)"/>
        </svg>
      </span>
      DeepLog
    </h1>
    <p style="opacity:0.85; font-size:15.5px;">
      Upload your server logs to detect <span style="color:#60a5fa;">anomalies</span>, <span style="color:#36c8ef;">threats</span>, and security issues in real time.
    </p>

    <form id="uploadForm" action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
      <input type="file" name="logfile" required>
      <button type="submit">Start Analysis</button>
    </form>

    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar">0%</div>
    </div>
    <div class="progress-label" id="progressLabel">Uploading...</div>
  </div>
  <audio id="bgMusic" src="{{ url_for('static', filename='background.mp3') }}" autoplay loop></audio>
    <button id="musicBtn" style="position:fixed;left:30px;bottom:30px;z-index:150;background:rgba(30,40,60,0.81);color:#fff;font-size:17px;padding:12px 23px;border-radius:16px;border:none;box-shadow:0 3px 16px #1e1e2f44;font-weight:700;cursor:pointer;letter-spacing:1px;">ðŸ”Š Music On</button>
    <script>
    const bgMusic = document.getElementById('bgMusic');
    const musicBtn = document.getElementById('musicBtn');
    let isPlaying = true;
    musicBtn.onclick = function() {
        if(isPlaying) {
            bgMusic.pause();
            musicBtn.textContent = "ðŸ”‡ Music Off";
        } else {
            bgMusic.play();
            musicBtn.textContent = "ðŸ”Š Music On";
        }
        isPlaying = !isPlaying;
    };
    window.addEventListener('click', function playAudioOnce() {
        bgMusic.play();
        window.removeEventListener('click', playAudioOnce);
    });
    </script>
  <!-- DONATION BUTTON + POPUP -->
  <button class="donate-btn" id="donateBtn">ðŸ’Ž Donate</button>
  <div class="donate-modal" id="donateModal">
    <div class="donate-modal-content">
      <span class="donate-close" id="donateClose">&times;</span>
      <h2 style="margin-bottom:18px;">Support DeepLog</h2>
      <div style="margin-bottom: 8px; font-size:15.5px;">USDT TRC20:</div>
      <div class="donate-wallet">TTttSQ274h6bEAbtS2mbLNQVg3K3HiSU6y <button class="copy-btn" data-copy="TTttSQ274h6bEAbtS2mbLNQVg3K3HiSU6y">Copy</button></div>
      <div style="margin-top: 14px; margin-bottom: 8px; font-size:15.5px;">BTC:</div>
      <div class="donate-wallet">1AbHQdVVLzAGQv153UnJmvKsmWdX6sEfjk <button class="copy-btn" data-copy="1AbHQdVVLzAGQv153UnJmvKsmWdX6sEfjk">Copy</button></div>
      <div id="donateCopyMsg" class="copy-msg"></div>
    </div>
  </div>

  <script>
  // Progress-bar logic (Ñ‚Ð²Ð¾Ñ ÑÑ‚Ð°Ñ€Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ°)
  const form = document.getElementById('uploadForm');
  const progressBar = document.getElementById('progressBar');
  const progressContainer = document.getElementById('progressContainer');
  const progressLabel = document.getElementById('progressLabel');

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const fileInput = form.querySelector('input[type="file"]');
    if (!fileInput.files.length) return;
    const fileSize = fileInput.files[0].size;
    const minUploadDuration = 3000;
    const msPerMB = 500;
    const fileSizeMB = fileSize / (1024 * 1024);
    const uploadDuration = minUploadDuration + fileSizeMB * msPerMB;
    const analyzeDuration = 2000;

    progressContainer.style.display = 'block';
    progressLabel.style.display = 'block';
    progressBar.style.width = '0%';
    progressBar.textContent = '0%';
    progressLabel.textContent = 'Uploading...';

    const formData = new FormData(form);
    const xhr = new XMLHttpRequest();
    xhr.open('POST', form.action, true);
    let percent = 0;
    const uploadSteps = 99;
    const uploadStepTime = uploadDuration / uploadSteps;
    const uploadInterval = setInterval(() => {
      if (percent < 99) {
        percent += 1;
        progressBar.style.width = percent + '%';
        progressBar.textContent = percent + '%';
      }
    }, uploadStepTime);

    xhr.onload = function() {
      clearInterval(uploadInterval);
      progressLabel.textContent = 'Analyzing...';
      let analyzePercent = percent;
      const analyzeSteps = 100 - analyzePercent;
      const analyzeStepTime = analyzeDuration / analyzeSteps;
      const analyzeInterval = setInterval(() => {
        analyzePercent += 1;
        progressBar.style.width = analyzePercent + '%';
        progressBar.textContent = analyzePercent + '%';
        if (analyzePercent >= 100) {
          clearInterval(analyzeInterval);
          progressLabel.textContent = 'Completed!';
          setTimeout(() => {
            document.open();
            document.write(xhr.responseText);
            document.close();
          }, 800);
        }
      }, analyzeStepTime);
    };
    xhr.onerror = function() {
      clearInterval(uploadInterval);
      progressLabel.textContent = 'Upload failed.';
    };
    xhr.send(formData);
  });

  // Donation popup logic
  const donateBtn = document.getElementById('donateBtn');
  const donateModal = document.getElementById('donateModal');
  const donateClose = document.getElementById('donateClose');
  donateBtn.onclick = () => donateModal.style.display = 'flex';
  donateClose.onclick = () => donateModal.style.display = 'none';
  window.onclick = (e) => {
    if (e.target == donateModal) donateModal.style.display = 'none';
  };
  // Copy button logic
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.onclick = function() {
      const value = btn.getAttribute('data-copy');
      navigator.clipboard.writeText(value);
      const msg = document.getElementById('donateCopyMsg');
      msg.innerText = "Copied!";
      msg.style.opacity = "1";
      setTimeout(()=>{ msg.style.opacity = "0"; }, 1300);
    }
  });
  </script>
</body>
</html>
